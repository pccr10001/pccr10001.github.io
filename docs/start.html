<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="icon" href="/teslabtapi/img/icon.svg">
<link rel="manifest" href="/teslabtapi/manifest.json">
<meta name="theme-color" content="rgb(232, 33, 39)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/teslabtapi/img/icon.svg">
<link rel="mask-icon" href="/teslabtapi/img/icon.svg" color="rgb(232, 33, 39)">
<meta name="msapplication-TileImage" content="/teslabtapi/img/icon.svg">
<meta name="msapplication-TileColor" content="#000">
<link rel="preconnect" href="https://analytics.lexnastin.com">
<script async src="https://analytics.lexnastin.com/tracker.js"></script>
<script src="/remove-cookies.js" defer="defer"></script><title data-react-helmet="true">Getting Started | Tesla BluetoothLE API (Unofficial)</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pccr10001.github.io//teslabtapi/docs/start"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Getting Started | Tesla BluetoothLE API (Unofficial)"><meta data-react-helmet="true" name="description" content="I really recommend reading this over to grasp an understanding of how this stuff works. If you just want to see what the car can do, skip down to more info."><meta data-react-helmet="true" property="og:description" content="I really recommend reading this over to grasp an understanding of how this stuff works. If you just want to see what the car can do, skip down to more info."><link data-react-helmet="true" rel="icon" href="/teslabtapi/img/icon.svg"><link data-react-helmet="true" rel="canonical" href="https://pccr10001.github.io//teslabtapi/docs/start"><link data-react-helmet="true" rel="alternate" href="https://pccr10001.github.io//teslabtapi/docs/start" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pccr10001.github.io//teslabtapi/docs/start" hreflang="x-default"><link rel="stylesheet" href="/teslabtapi/assets/css/styles.d8624263.css">
<link rel="preload" href="/teslabtapi/assets/js/runtime~main.d727fc49.js" as="script">
<link rel="preload" href="/teslabtapi/assets/js/main.c72a0378.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/teslabtapi/"><div class="navbar__logo"><img src="/teslabtapi/img/icon.svg" alt="Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/teslabtapi/img/icon.svg" alt="Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Tesla BluetoothLE API (Unofficial)</b></a><a class="navbar__item navbar__link navbar__link--active" href="/teslabtapi/docs/intro">Tutorial</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ArchGryphon9362/teslabtapi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/teslabtapi/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/teslabtapi/docs/start">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/teslabtapi/docs/charsandservices">Characteristics And Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/teslabtapi/docs/tovcsec">ToVCSECMessage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/teslabtapi/docs/fromvcsec">FromVCSECMessage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/teslabtapi/docs/other/activek">Other Messages</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/teslabtapi/docs/enums/activity_e">Enums</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_2fq0" href="/teslabtapi/docs/other_vcsec_com_devices/fromkeyfob">Other Devices</a></div></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting Started</h1></header><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>I really recommend reading this over to grasp an understanding of how this stuff works. If you just want to see what the car can do, skip down to <a href="#more-info">more info</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="whitelisting-your-key">Whitelisting your key<a aria-hidden="true" class="hash-link" href="#whitelisting-your-key" title="Direct link to heading">â€‹</a></h2><p>To begin working with the vehicle&#x27;s BLE API, you&#x27;ll need to generate and whitelist your public key with the vehicle.</p><p>To do this, you&#x27;ll need two things:</p><ul><li>Generate an EC private key with the NISTP256 curve (aka secp256r1, or prime256v1)<ul><li>Keep this safe! This key is used to sign all your messages.</li></ul></li><li>Using your private key, you&#x27;ll need to generate a public key serialized to bytes in the ANSI X9.62/X9.63 Uncompressed Point format<ul><li>If done correctly, the first byte should always be <code>0x04</code></li><li>I never tried it, but Compressed Point might work too, that is where the first byte is <code>0x02</code> or <code>0x03</code>. If it does work, please tell me so that I can update the documentation! If you&#x27;re feeling wild and try out any other public key encodings that work, then please notify me too!</li></ul></li></ul><p>We&#x27;ll call these <code>privateKey</code>, and <code>publicKey</code> respectively.</p><p>Next serialize, an unsigned protobuf message from the VCSEC protobuf in the following layout:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WhitelistOperation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addKeyToWhitelistAndAddPermissions {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            key {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PublicKeyRaw: &lt;publicKey&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permission: WHITELISTKEYPERMISSION_LOCAL_DRIVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permission: WHITELISTKEYPERMISSION_LOCAL_UNLOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permission: WHITELISTKEYPERMISSION_REMOTE_DRIVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permission: WHITELISTKEYPERMISSION_REMOTE_UNLOCK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadataForKey {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            keyFormFactor: KEY_FORM_FACTOR_ANDROID_DEVICE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You may add any other permissions as needed but these are the default ones (the ones that let you unlock, and start the vehicle, among other things). We&#x27;ll call the previously serialized message the <code>protoMsg</code>.</p><p>Once you have it serialized to bytes, you need to make a <code>ToVCSECMessage</code> message of the following format:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ToVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protobufMessageAsBytes: &lt;protoMsg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signatureType: SIGNATURE_TYPE_PRESENT_KEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, serialize this message to bytes. We&#x27;ll call this <code>authMsg</code>.</p><p>We need to prepare this message by defining a function <code>prependLength</code>:</p><ul><li>Extends the length of the byte array by two</li><li>Shifts all bytes to the right by two</li><li>Sets the first two bytes to the length of the message<ul><li>Note: In most/all cases the byte array will be the final serialized message</li></ul></li></ul><div class="codeBlockContainer_K1bP language-python"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">someMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">b&#x27;\x01\x02&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prependedMsg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prependLength</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">someMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prependedMsg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># b&#x27;\x00\x02\x01\x02&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once you have serialized <code>protoMsg</code>, and prepended the length, send the message to the vehicle over a normal BluetoothLE connection on the following write characteristic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Serivce: 00000211-b2d1-43f0-9b88-960cebf8b91e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID: 00000212-b2d1-43f0-9b88-960cebf8b91e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Descriptor: 0x2901</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="vehicle-ble-name">Vehicle BLE Name<a aria-hidden="true" class="hash-link" href="#vehicle-ble-name" title="Direct link to heading">â€‹</a></h3><p>The vehicle&#x27;s BLE name should match the following regular expression:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/ ^S[a-f\d]{16}[A-F]$ /</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In human talk, the BLE name should be composed of the following:</p><ul><li>&quot;S&quot;</li><li>16 characters from this list: &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, or &quot;9&quot;</li><li>One character that is either &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, or &quot;F&quot;</li></ul><p>For example, <code>SaaaaaaaaaaaaaaaaF</code> or <code>Sc6b7ccc84c5b6418B</code> would be a valid BLE name for the car.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="response">Response<a aria-hidden="true" class="hash-link" href="#response" title="Direct link to heading">â€‹</a></h3><p>The vehicle will always respond with a <code>FromVCSECMessage</code> message.</p><p>The first two bytes of this message represent the length of the message.</p><p>The rest of the message can then be decoded. Below is an example response to a whilelist request:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FromVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commandStatus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operationStatus: OPERATIONSTATUS_WAIT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It should be received on the following indication characteristic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Serivce: 00000211-b2d1-43f0-9b88-960cebf8b91e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID: 00000213-b2d1-43f0-9b88-960cebf8b91e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Descriptor: 0x2901</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now tap an existing key card, and you should recieve the following message:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FromVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    commandStatus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        whitelistOperationStatus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            signerOfOperation {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                publicKeySHA1: 0x5f0d64b3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Congrats! You whitelisted your first key!</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="getting-the-ephemeral-key">Getting the ephemeral key<a aria-hidden="true" class="hash-link" href="#getting-the-ephemeral-key" title="Direct link to heading">â€‹</a></h2><p>To sign messages to send to the vehicle, you&#x27;ll need to get the vehicle&#x27;s ephemeral key.</p><p>By definition, this name should change every so often, but I never experienced it change in the few days of testing that I&#x27;ve done.</p><p>First, generate the <code>keyId</code>. This can be done by taking the first 4 bytes of a SHA1 digest of <code>publicKey</code>.</p><p>Now that you have your <code>keyId</code>, you&#x27;ll need to request the vehicle&#x27;s ephemeral key. You can do this by making a <code>ToVCSECMessage</code> message with the following layout:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ToVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        InformationRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            informationRequestType: INFORMATION_REQUEST_TYPE_GET_EPHEMERAL_PUBLIC_KEY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            keyId {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                publicKeySHA1: &lt;keyId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, serialize this message to bytes as <code>getEphemeralBytes</code>. Prepend the message with <code>prependLength(getEphemeralBytes)</code>, and send the value to the vehicle.</p><p>The vehicle should respond with a message in the ANSI X9.62/X9.63 Uncompressed Point format, with the NISTP256 format. When decoded, it should looks something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FromVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sessionInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        publicKey: &lt;vehicle&#x27;s ephemeral key&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now that you have the <code>ephemeral_key</code>, generate an AES secret from the <code>ephemeral_key</code> and your secret key. Next, make a SHA1 of it, and put take the first 16 bytes to form your <code>sharedKey</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="authenticating">Authenticating<a aria-hidden="true" class="hash-link" href="#authenticating" title="Direct link to heading">â€‹</a></h2><p>For the vehicle to know that you are connected and to be able to send/receive messages, you need to generate an authentication message in the following format:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authenticationResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        authenticationLevel: AUTHENTICATION_LEVEL_NONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Set a variable called <code>counter</code> to 1 (can be any number that hasn&#x27;t been used as the counter for this key and must be &gt;= 1), which you should increment each time after using.</p><p>Now, you need to encrypt this message using the <code>sharedKey</code> with AES encryption in GCM mode, with a nonce of the <code>counter</code>, split into 4 bytes in big-endian, where the least significant byte is at the end.</p><p>For example, if <code>counter</code> is 23, the nonce will be <code>b&#x27;\x00\x00\x00\x17&#x27;</code>.</p><p>You should also separate the encrypted/signed message into 2 variables, <code>encryptedMsg</code> (from bytes 0 to <code>length</code> - 16), and <code>msgSignature</code> (from bytes <code>length</code> - 16 to <code>length</code>).</p><p>Now you can send the message to the vehicle! Use the following format:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ToVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protobufMessageAsBytes: &lt;encryptedMsg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature: &lt;msgSignature&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counter: &lt;counter&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keyId: &lt;keyId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now, prepare the message by serializing and prepending the length of the message. It is now ready to be sent to the vehicle!</p><p>Once complete, as long as you stay connected to the vehicle&#x27;s BLE, your key will stay marked in the vehicle as an active key.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="authenticating-for-other-things">Authenticating for other things<a aria-hidden="true" class="hash-link" href="#authenticating-for-other-things" title="Direct link to heading">â€‹</a></h2><p>If you want to let the vehicle do things automatically without sending messages to do things (i.e. like the Tesla App does when you&#x27;re next to/inside the vehicle), you can send it an authentication response of a higher level to give permission to do everything under and including that level, so say <code>level = &#x27;UNLOCK&#x27;</code>, you are only letting the vehicle unlock, but say you do <code>level = &#x27;DRIVE&#x27;</code>, you can unlock <em>or</em> drive. Also, everytime the vehicle does something automatically, the vehicle resets level to <code>NONE</code>.</p><p>All that you have to do is serialize and sign an auth message where the distance is optional, but if not sent to the vehicle, it will just automatically assume that you&#x27;re next to/inside the vehicle:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        authenticationLevel: AUTHENTICATION_LEVEL_&lt;LEVEL&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        estimatedDistance: &lt;distance&gt; # optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once you sign that message, I&#x27;ll call it <code>signedAuthMsg</code>, and its signature <code>signedAuthSign</code>, and turn it into a ToVCSECMessage message like this, which you then serialize, prepend the length, and send to the vehicle:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ToVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protobufMessageAsBytes: &lt;signedAuthMsg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature: &lt;signedAuthSign&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counter: &lt;counter&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keyId: &lt;keyId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>I recommend only changing this to other auth levels when the car requests it. Here&#x27;s an example of a message you may get from the car, requesting to unlock it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">FromVCSECMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authenticationRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sessionInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        token: &quot;some random token that i don&#x27;t know the use of&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requestedLevel: AUTHENTICATION_LEVEL_DRIVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this case you&#x27;ll just send the car back the following message:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AuthenticationResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        authenticationLevel: AUTHENTICATION_LEVEL_DRIVE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Don&#x27;t worry about the walk-away car lock, when you walk away the car will automatically lock</p></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="sending-manual-actions">Sending manual actions<a aria-hidden="true" class="hash-link" href="#sending-manual-actions" title="Direct link to heading">â€‹</a></h2><p>Say a user interacts with an app or needs to do something that can&#x27;t be done automatically. In that case you need to send an RKE action. You can send those by making a message in the following format, signing it, prepending length, and sending it to the vehicle like with any other signed message:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">UnsignedMessage {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RKEAction_E: &lt;any rke action&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="more-info">More Info<a aria-hidden="true" class="hash-link" href="#more-info" title="Direct link to heading">â€‹</a></h2><p>For more info, you can begin looking at <a href="/teslabtapi/docs/tovcsec">ToVCSECMessage</a> (<a href="/teslabtapi/docs/other/unsignedmsg">UnsignedMessage</a> in particular) to see things you can send to the car, and <a href="/teslabtapi/docs/fromvcsec">FromVCSECMessage</a> to see things you receive to the car.</p><p>Don&#x27;t forget, VCSEC is the vehicle&#x27;s secondary security system, so you send <code>ToVCSECMessage</code> messages, and the vehicle sends you back <code>FromVCSECMessage</code> messages.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>There is only one exception to this rule: when you added your key as keyfob. In this case you would use <code>FromKeyfobMessage</code> instead of <code>ToVCSECMessage</code>, and <code>ToKeyfobMessage</code> instead of <code>FromVCSECMessage</code>.</p><p>There is also an exception for tire pressure sensors, but I have absolutely no idea of how they work, and don&#x27;t have time to research.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ArchGryphon9362/teslabtapi/edit/main/docs/start.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/teslabtapi/docs/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Intro</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/teslabtapi/docs/charsandservices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Characteristics And Services<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#whitelisting-your-key" class="table-of-contents__link toc-highlight">Whitelisting your key</a><ul><li><a href="#vehicle-ble-name" class="table-of-contents__link toc-highlight">Vehicle BLE Name</a></li><li><a href="#response" class="table-of-contents__link toc-highlight">Response</a></li></ul></li><li><a href="#getting-the-ephemeral-key" class="table-of-contents__link toc-highlight">Getting the ephemeral key</a></li><li><a href="#authenticating" class="table-of-contents__link toc-highlight">Authenticating</a></li><li><a href="#authenticating-for-other-things" class="table-of-contents__link toc-highlight">Authenticating for other things</a></li><li><a href="#sending-manual-actions" class="table-of-contents__link toc-highlight">Sending manual actions</a></li><li><a href="#more-info" class="table-of-contents__link toc-highlight">More Info</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/teslabtapi/assets/js/runtime~main.d727fc49.js"></script>
<script src="/teslabtapi/assets/js/main.c72a0378.js"></script>
<script>var ackeeServer="https://analytics.lexnastin.com",ackeeDomainId="c21a18c1-4e62-485b-9eb4-a40feebb5164",ackeeDetailed=!0,ackeeIgnoreLocalhost=!1,ackeeIgnoreOwnVisits=!0;ackeeTracker.create("https://analytics.lexnastin.com",{detailed:!0,ignoreLocalhost:!1,ignoreOwnVisits:!0}).record("c21a18c1-4e62-485b-9eb4-a40feebb5164")</script></body>
</html>